#!/usr/bin/env bash
# Quick route validation for developers

set -e

echo "ğŸ” Quick Route Check..."

# Check if Docker is running
if ! docker-compose ps | grep -q "Up"; then
  echo "âš ï¸  Starting services..."
  docker-compose up -d db redis
  sleep 2
fi

# Quick route audit
echo "ğŸ“‹ Running route audit..."
if docker-compose run --rm web rake routes:audit | grep -q "No hardcoded paths found"; then
  echo "âœ… No hardcoded paths - Good!"
else
  echo "âš ï¸  Hardcoded paths detected"
fi

if docker-compose run --rm web rake routes:audit | grep -q "ViewComponent route helper usage is correct"; then
  echo "âœ… ViewComponent routes - Good!"
else
  echo "âš ï¸  ViewComponent issues detected"
  echo "ğŸ’¡ Run: rake routes:fix_common_issues"
fi

# Count missing routes
MISSING_COUNT=$(docker-compose run --rm web rake routes:audit 2>/dev/null | grep -A 50 "MISSING ROUTE HELPERS" | grep "   â€¢" | wc -l | tr -d ' ')

if [ "$MISSING_COUNT" -gt 0 ]; then
  echo "âš ï¸  $MISSING_COUNT missing route helpers detected"
  echo "ğŸ’¡ Check docs/DEVELOPMENT_ROUTE_GUIDELINES.md for solutions"
else
  echo "âœ… All route helpers exist!"
fi

echo ""
echo "ğŸ¯ Route Status Summary:"
echo "   - Hardcoded paths: âœ… None"
echo "   - ViewComponent usage: âœ… Correct"  
echo "   - Missing helpers: âš ï¸  $MISSING_COUNT"
echo ""
echo "ğŸ’¡ For full validation: rake dev:validate_routes"