<div class="<%= wrapper_classes %>" data-controller="data-grid">
  <table class="<%= table_classes %>">
    <thead class="bg-gray-50">
      <tr>
        <% if selectable %>
          <th scope="col" class="relative px-6 py-3">
            <input type="checkbox" 
                   class="form-checkbox h-4 w-4 text-primary-600 rounded border-gray-300"
                   data-action="change->data-grid#toggleAll"
                   aria-label="Select all rows">
          </th>
        <% end %>
        
        <% columns.each do |column| %>
          <th scope="col" 
              class="<%= header_cell_classes(column) %>"
              <%= "data-sortable='true' data-sort-key='#{column[:key]}' data-action='click->data-grid#sort'" if column[:sortable] %>
              style="<%= "width: #{column[:width]}" if column[:width] %>">
            <div class="flex items-center <%= 'justify-center' if column[:align] == :center %> <%= 'justify-end' if column[:align] == :right %>">
              <%= column[:label] %>
              <% if column[:sortable] %>
                <svg class="ml-1 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                </svg>
              <% end %>
            </div>
          </th>
        <% end %>
        
        <% if actions? %>
          <th scope="col" class="relative px-6 py-3">
            <span class="sr-only">Actions</span>
          </th>
        <% end %>
      </tr>
    </thead>
    
    <tbody class="bg-white divide-y divide-gray-200">
      <% if loading %>
        <%= loading_rows %>
      <% elsif data.empty? %>
        <tr>
          <td colspan="<%= columns.size + (selectable ? 1 : 0) + (actions? ? 1 : 0) %>" class="px-6 py-12 text-center">
            <% if empty_state? %>
              <%= empty_state %>
            <% else %>
              <div class="text-gray-500">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p class="mt-2 text-sm">Aucune donn√©e disponible</p>
              </div>
            <% end %>
          </td>
        </tr>
      <% else %>
        <% data.each_with_index do |item, index| %>
          <tr class="<%= row_classes(index) %>" 
              <%= "data-action='click->data-grid#rowClick' data-row-id='#{item.try(:id)}'" if options[:row_click] %>>
            <% if selectable %>
              <td class="px-6 py-4">
                <input type="checkbox" 
                       class="form-checkbox h-4 w-4 text-primary-600 rounded border-gray-300"
                       value="<%= item.try(:id) %>"
                       <%= 'checked' if selected.include?(item.try(:id)) %>
                       data-action="change->data-grid#toggleRow"
                       aria-label="Select row">
              </td>
            <% end %>
            
            <% columns.each do |column| %>
              <td class="<%= body_cell_classes(column) %>">
                <% value = item.try(column[:key]) || item[column[:key]] %>
                <% formatted_value = format_value(value, column[:format]) %>
                
                <% if column[:options][:link] %>
                  <%= link_to formatted_value, column[:options][:link].call(item), 
                      class: "text-primary-600 hover:text-primary-900 font-medium" %>
                <% elsif column[:options][:component] %>
                  <%= render column[:options][:component].new(item: item, value: value) %>
                <% else %>
                  <%= formatted_value %>
                <% end %>
              </td>
            <% end %>
            
            <% if actions? %>
              <td class="px-6 py-4 text-right text-sm font-medium">
                <% actions.each do |action| %>
                  <%= action.call(item) %>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>

<style>
  .table-striped tbody tr:nth-child(odd) {
    @apply bg-gray-50;
  }
  
  .table-hover tbody tr:hover {
    @apply bg-gray-50;
  }
</style>